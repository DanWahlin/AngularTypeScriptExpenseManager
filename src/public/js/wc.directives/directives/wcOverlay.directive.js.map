{"version":3,"sources":["wc.directives/directives/wcOverlay.directive.ts"],"names":["wc","wc.directives","wc.directives.OverlayDirective","wc.directives.OverlayDirective.constructor","wc.directives.OverlayDirective.instance","wc.directives.OverlayDirective._link","wc.directives.OverlayDirective._link.init","wc.directives.OverlayDirective._link.wireUpHttpInterceptor","wc.directives.OverlayDirective._link.wirejQueryInterceptor","wc.directives.OverlayDirective._link.processRequest","wc.directives.OverlayDirective._link.processResponse","wc.directives.OverlayDirective._link.showOverlay","wc.directives.OverlayDirective._link.hideOverlay","wc.directives.OverlayDirective._link.getComputedStyle"],"mappings":"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","file":"wc.directives/directives/wcOverlay.directive.js","sourcesContent":["///<reference path=\"../../../../../tools/typings/tsd.d.ts\" />\n///<reference path=\"../../../../../tools/typings/expenseApp.d.ts\" />\n\nmodule wc.directives {\n\n    interface IJQueryWindow extends ng.IWindowService {\n       jQuery;\n    }\n\n    interface IOverlayScope extends ng.IScope {\n        wcOverlayDelay: string;\n    }\n\n    class OverlayDirective implements ng.IDirective {\n\n        static $inject = ['$q', '$timeout', '$window', 'httpInterceptor'];\n        static instance($q: ng.IQService, $timeout: ng.ITimeoutService,\n                        $window: IJQueryWindow, httpInterceptor) : ng.IDirective {\n            return new OverlayDirective($q, $timeout, $window, httpInterceptor);\n        }\n\n        restrict = 'EA';\n        transclude= true;\n        scope = { wcOverlayDelay: '@' };\n        template = '<div id=\"overlay-container\" class=\"overlayContainer\">' +\n                        '<div id=\"overlay-background\" class=\"overlayBackground\"></div>' +\n                        '<div id=\"overlay-content\" class=\"overlayContent\" data-ng-transclude>' +\n                        '</div>' +\n                    '</div>';\n        link: (scope: IOverlayScope, element: ng.IAugmentedJQuery) => void;\n\n        constructor(private $q: ng.IQService, private $timeout: ng.ITimeoutService,\n                    private $window: IJQueryWindow, private httpInterceptor) {\n            this.link = this._link.bind(this);\n        }\n\n        private _link(scope: IOverlayScope, element: ng.IAugmentedJQuery) {\n            var overlayContainer = null,\n            timerPromise = null,\n            timerPromiseHide = null,\n            queue = [],\n            delay: number,\n            computedStyleFunc,\n            $q: ng.IQService = this.$q,\n            $timeout: ng.ITimeoutService = this.$timeout,\n            $window: IJQueryWindow = this.$window,\n            httpInterceptor = this.httpInterceptor;\n\n            init();\n\n            function init() {\n                wireUpHttpInterceptor();\n                if ($window.jQuery) { wirejQueryInterceptor(); }\n                overlayContainer = element[0].firstChild; //Get to template\n                delay = scope.wcOverlayDelay ? parseInt(scope.wcOverlayDelay, 10) : 500;\n                computedStyleFunc = getComputedStyle();\n            }\n\n            //Hook into httpInterceptor factory request/response/responseError functions\n            function wireUpHttpInterceptor() {\n                httpInterceptor.request = function (config) {\n                    processRequest();\n                    return config || $q.when(config);\n                };\n\n                httpInterceptor.response = function (response) {\n                    processResponse();\n                    return response || $q.when(response);\n                };\n\n                httpInterceptor.responseError = function (rejection) {\n                    processResponse();\n                    return $q.reject(rejection);\n                };\n            }\n\n            //Monitor jQuery Ajax calls in case it's used in an app\n            function wirejQueryInterceptor() {\n                $($window.document).ajaxStart(function () {\n                    processRequest();\n                });\n\n                $($window.document).ajaxComplete(function () {\n                    processResponse();\n                });\n\n                $($window.document).ajaxError(function () {\n                    processResponse();\n                });\n            }\n\n            function processRequest() {\n                queue.push({});\n                if (queue.length === 1) {\n                    timerPromise = $timeout(function () {\n                        if (queue.length) { showOverlay(); }\n                        //Delay showing for 500 millis to avoid flicker\n                    }, delay);\n                }\n            }\n\n            function processResponse() {\n                queue.pop();\n                if (queue.length === 0) {\n                    //Since we don't know if another XHR request will be made, pause before\n                    //hiding the overlay. If another XHR request comes in then the overlay\n                    //will stay visible which prevents a flicker\n                    timerPromiseHide = $timeout(() => {\n                        //Make sure queue is still 0 since a new XHR request may have come in\n                        //while timer was running\n                        if (queue.length === 0) {\n                            hideOverlay();\n                            if (timerPromiseHide) { $timeout.cancel(timerPromiseHide); }\n                        }\n                    }, delay);\n                }\n            }\n\n            function showOverlay() {\n                var w = 0,\n                    h = 0,\n                    document = $window.document;\n\n                if (!$window.innerWidth) {\n                    if (!(document.documentElement.clientWidth === 0)) {\n                        w = document.documentElement.clientWidth;\n                        h = document.documentElement.clientHeight;\n                    } else {\n                        w = document.body.clientWidth;\n                        h = document.body.clientHeight;\n                    }\n                } else {\n                    w = $window.innerWidth;\n                    h = $window.innerHeight;\n                }\n                var content = document.getElementById('overlay-content');\n                var contentWidth = parseInt(computedStyleFunc(content, 'width').replace('px', ''), 10);\n                var contentHeight = parseInt(computedStyleFunc(content, 'height').replace('px', ''), 10);\n\n                content.style.top = h / 2 - contentHeight / 2 + 'px';\n                content.style.left = w / 2 - contentWidth / 2 + 'px';\n\n                overlayContainer.style.display = 'block';\n            }\n\n            function hideOverlay() {\n                if (timerPromise) { $timeout.cancel(timerPromise); }\n                overlayContainer.style.display = 'none';\n            }\n\n            function getComputedStyle() {\n                var func = null,\n                    document = $window.document;\n\n                if (document.defaultView && document.defaultView.getComputedStyle) {\n                    func = document.defaultView.getComputedStyle;\n                } else if (typeof (document.body['currentStyle']) !== 'undefined') {\n                    func = (element, anything) => {\n                        return element['currentStyle'];\n                    };\n                }\n\n                return (element, style) => {\n                    return func(element, null)[style];\n                };\n            }\n        }\n    }\n\n    var wcDirectivesApp = angular.module('wc.directives', []);\n\n    //Empty factory to hook into $httpProvider.interceptors\n    //Directive will hookup request, response, and responseError interceptors\n    wcDirectivesApp.factory('httpInterceptor', () => {\n        return {};\n    });\n\n    //Hook httpInterceptor factory into the $httpProvider interceptors so that we can monitor XHR calls\n    wcDirectivesApp.config(['$httpProvider', ($httpProvider) => {\n        $httpProvider.interceptors.push('httpInterceptor');\n    }]);\n\n    //Directive that uses the httpInterceptor factory above to monitor XHR calls\n    //When a call is made it displays an overlay and a content area\n    //No attempt has been made at this point to test on older browsers\n    wcDirectivesApp.directive('wcOverlay', ['$q', '$timeout', '$window', 'httpInterceptor', OverlayDirective.instance]);\n\n}\n"],"sourceRoot":"/source/"}