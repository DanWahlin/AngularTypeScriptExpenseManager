{"version":3,"sources":["expenseApp/services/data.service.ts"],"names":["expenseApp","expenseApp.services","expenseApp.services.DataService","expenseApp.services.DataService.constructor","expenseApp.services.DataService.getEmployeesAndExpenses","expenseApp.services.DataService.getEmployeesSummary","expenseApp.services.DataService.getStates","expenseApp.services.DataService.getEmployee","expenseApp.services.DataService.getEmployeeExpenses","expenseApp.services.DataService.insertEmployee","expenseApp.services.DataService.newEmployee","expenseApp.services.DataService.updateEmployee","expenseApp.services.DataService.deleteEmployee","expenseApp.services.DataService.getPagedResource","expenseApp.services.DataService.buildPagingUri","expenseApp.services.DataService.mapEmployeeToExpenses","expenseApp.services.DataService.extendEmployees","expenseApp.services.DataService.calculateExpensesTotal"],"mappings":"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","file":"expenseApp/services/data.service.js","sourcesContent":["///<reference path=\"../../../../../tools/typings/tsd.d.ts\" />\n///<reference path=\"../../../../../tools/typings/expenseApp.d.ts\" />\n\nnamespace expenseApp.services {\n    'use strict';\n\n    export class DataService {\n        baseEmployeesUrl: string = '/api/employees';\n        baseStatesUrl: string = '/api/states';\n\n        static $inject = ['$http', '$q', '$window', '$location', '$timeout'];\n        constructor(private $http: ng.IHttpService, private $q: ng.IQService, private $window: ng.IWindowService,\n                    private $location: ng.ILocationService, private $timeout: ng.ITimeoutService) {\n\n        }\n\n        getEmployeesAndExpenses() : ng.IPromise<shared.IEmployee[]> {\n            return this.$http.get(this.baseEmployeesUrl + '/expenses').then(\n            (result: ng.IHttpPromiseCallbackArg<shared.IEmployee[]>) => {\n                   var employees = result.data;\n                   this.extendEmployees(employees);\n                   return employees;\n            },\n            (error: shared.IHttpPromiseCallbackErrorArg) => {\n                this.$window.alert(error.message);\n                return error;\n            });\n        }\n\n        getEmployeesSummary(pageIndex, pageSize) : ng.IPromise<shared.IPagedResult> {\n            return this.getPagedResource(this.baseEmployeesUrl, pageIndex, pageSize);\n        }\n\n        getStates() : ng.IPromise<shared.IState[]> {\n            return this.$http.get(this.baseStatesUrl).then(\n            (result: ng.IHttpPromiseCallbackArg<shared.IState[]>) => {\n                return result.data;\n            });\n        }\n\n        getEmployee(id): ng.IPromise<shared.IEmployee> {\n            return this.$http.get(this.baseEmployeesUrl + '/' + id).then(\n                (result: ng.IHttpPromiseCallbackArg<shared.IEmployee>) => {\n                    var cust: shared.IEmployee = <shared.IEmployee>result.data;\n                    return cust;\n                },\n                (error: shared.IHttpPromiseCallbackErrorArg) => {\n                    this.$window.alert(error.message);\n                }\n            );\n        }\n\n//        checkUniqueValue(id, property, value) {\n//            if (!id) { id = 0; }\n//            return this.$http.get(this.serviceBase + 'checkUnique/' + id + '?property=' + property +\n//                                  '&value=' + escape(value), this.getOptions)\n//                .then((results) => {\n//                    return results.data.status;\n//                }\n//            );\n//        }\n\n        getEmployeeExpenses(id) : ng.IPromise<shared.IEmployee> {\n            return this.$http.get(this.baseEmployeesUrl + '/expenses/' + id).then(\n            (result: ng.IHttpPromiseCallbackArg<shared.IEmployee>) => {\n               var employee = result.data;\n               this.calculateExpensesTotal(employee);\n               return employee;\n            }, \n            (error: shared.IHttpPromiseCallbackErrorArg) => {\n                this.$window.alert(error.message);\n                return error;\n            });\n        }\n\n        insertEmployee(employee) : ng.IPromise<shared.IEmployee> {\n            return this.$http.post(this.baseEmployeesUrl, {employee: employee}).then(\n            (result: ng.IHttpPromiseCallbackArg<shared.IEmployee>) => {\n                return result.data;\n            },\n            (error: shared.IHttpPromiseCallbackErrorArg) => {\n                this.$window.alert(error.message);\n                return error;\n            });\n        }\n\n        newEmployee() : ng.IPromise<shared.IEmployee> {\n            return this.$q.when(<shared.IEmployee>{});\n        }\n\n        updateEmployee(employee) : ng.IPromise<shared.IEmployee> {\n            return this.$http.put(this.baseEmployeesUrl + '/' + employee.id, {employee: employee});\n        }\n\n        deleteEmployee(employee) : ng.IPromise<boolean> {\n            return this.$http.delete(this.baseEmployeesUrl + '/' + employee.id);\n        }\n        \n        getPagedResource(baseResource, pageIndex, pageSize) : ng.IPromise<shared.IPagedResult> {\n            var resource = baseResource;\n            resource += (arguments.length === 3) ? this.buildPagingUri(pageIndex, pageSize) : '';\n            return this.$http.get(resource).then(\n                (response: ng.IHttpPromiseCallbackArg<shared.IEmployee[]>) => {\n                    var employees = response.data;\n                    this.extendEmployees(employees);\n                    return {\n                        totalRecords: parseInt(response.headers('X-InlineCount'), 10),\n                        results: employees\n                    };\n                });\n        }\n\n        buildPagingUri(pageIndex, pageSize) : string {\n            var uri = '?pageSize=' + pageSize + '&skip=' + (pageIndex * pageSize);\n            return uri;\n        }\n\n        mapEmployeeToExpenses(employees: shared.IEmployee[], expenses: shared.IExpense[]) : void {\n            if (employees && expenses) {\n                for (var i = 0; i < employees.length; i++) {\n                    var employee = employees[i];\n                    var employeeExpenses = [];\n                    for (var j = 0; j < expenses.length; j++) {\n                        var expense = expenses[j];\n                        if (expense.id === employee.id) { \n                            employeeExpenses.push(expense);\n                        }\n                    }\n                    employee.expenses = employeeExpenses;\n                    this.calculateExpensesTotal(employee);\n                }\n            }\n        }\n\n        extendEmployees(employees) : void {\n            var employeesLen = employees.length;\n            //Iterate through employees\n            for (var i = 0; i < employeesLen; i++) {\n                var employee = employees[i];\n                if (employee.expenses) {\n                    this.calculateExpensesTotal(employee);\n                }\n            }\n        }\n\n        calculateExpensesTotal(employee: shared.IEmployee) : void {\n            var expensesLen = employee.expenses.length;\n            employee.expensesTotal = 0;\n            //Iterate through expenses\n            for (var j = 0; j < expensesLen; j++) {\n                employee.expensesTotal += employee.expenses[j].amount;\n            }\n        }\n\n    }\n\n\n    angular.module('expenseApp').service('expenseApp.services.dataService', DataService);\n\n}\n"],"sourceRoot":"/source/"}