{"version":3,"sources":["expenseApp/directives/wcUnique.directive.ts"],"names":["expenseApp","expenseApp.directives","expenseApp.directives.WcUniqueDirective","expenseApp.directives.WcUniqueDirective.constructor","expenseApp.directives.WcUniqueDirective.instance","expenseApp.directives.WcUniqueDirective._link"],"mappings":"AAAA,6DAA6D;AAC7D,oEAAoE;AAEpE,YAAY,CAAC;AAEb,IAAU,UAAU,CAsDnB;AAtDD,WAAU,UAAU;IAACA,IAAAA,UAAUA,CAsD9BA;IAtDoBA,WAAAA,UAAUA,EAACA,CAACA;QAO7BC;YAYIC,2BAAqBA,EAAgBA,EAAUA,WAA4CA;gBAAtEC,OAAEA,GAAFA,EAAEA,CAAcA;gBAAUA,gBAAWA,GAAXA,WAAWA,CAAiCA;gBAL3FA,aAAQA,GAAGA,GAAGA,CAACA;gBACfA,YAAOA,GAAGA,SAASA,CAACA;gBAKhBA,IAAIA,CAACA,IAAIA,GAAGA,IAAIA,CAACA,KAAKA,CAACA,IAAIA,CAACA,IAAIA,CAACA,CAACA;YACtCA,CAACA;YAXMD,0BAAQA,GAAfA,UAAgBA,EAAgBA,EAAEA,WAA4CA;gBAC1EE,MAAMA,CAACA,IAAIA,iBAAiBA,CAACA,EAAEA,EAAEA,WAAWA,CAACA,CAACA;YAClDA,CAACA;YAWDF,iCAAKA,GAALA,UAAMA,KAAgBA,EAAEA,OAA4BA,EAAEA,KAA0BA,EAAEA,OAAOA;gBAErFG,IAAIA,KAAKA,GAAGA,IAAIA,CAACA;gBAEjBA,OAAOA,CAACA,gBAAgBA,CAACA,MAAMA,GAAGA,UAAUA,UAAUA,EAAEA,SAASA;oBAC7D,IAAI,QAAQ,GAAG,KAAK,CAAC,EAAE,CAAC,KAAK,EAAE,EAC3B,YAAY,GAAG,UAAU,IAAI,SAAS,EACtC,GAAG,GAAG,KAAK,CAAC,WAAW,EACvB,QAAQ,GAAG,KAAK,CAAC,gBAAgB,CAAC;oBAEtC,AAGA,uDAHuD;oBACvD,0CAA0C;oBAC1C,sDAAsD;oBACtD,EAAE,CAAC,CAAC,GAAG,IAAI,QAAQ,CAAC,CAAC,CAAC;wBAClB,IAAI,CAAC,WAAW,CAAC,gBAAgB,CAAC,GAAG,EAAE,QAAQ,EAAE,YAAY,CAAC;6BACzD,IAAI,CAAC,UAAU,MAAM;4BAClB,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC;gCACT,QAAQ,CAAC,OAAO,EAAE,EAAE,aAAa;4BACrC,CAAC,GADsB;4BACrB,IAAI,CAAC,CAAC;gCACJ,QAAQ,CAAC,MAAM,EAAE,EAAE,uBAAuB;4BAC9C,CAAC,GADqB;wBAE1B,CAAC,CAAC,CAAC;wBACP,MAAM,CAAC,QAAQ,CAAC,OAAO,CAAC;oBAC5B,CAAC;oBAAC,IAAI,CAAC,CAAC;wBACJ,MAAM,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;oBAC/B,CAAC;gBACL,CAAC,CAACA;YACNA,CAACA;YAzCMH,yBAAOA,GAAGA,CAACA,IAAIA,EAAEA,iCAAiCA,CAACA,CAACA;YA0C/DA,wBAACA;QAADA,CA5CAD,AA4CCC,IAAAD;QAEDA,OAAOA,CAACA,MAAMA,CAACA,YAAYA,CAACA,CAACA,SAASA,CAACA,UAAUA,EAAEA,iBAAiBA,CAACA,QAAQA,CAACA,CAACA;IACnFA,CAACA,EAtDoBD,UAAUA,GAAVA,qBAAUA,KAAVA,qBAAUA,QAsD9BA;AAADA,CAACA,EAtDS,UAAU,KAAV,UAAU,QAsDnB","file":"expenseApp/directives/wcUnique.directive.js","sourcesContent":["///<reference path=\"../../../../../tools/typings/tsd.d.ts\" />\n///<reference path=\"../../../../../tools/typings/expenseApp.d.ts\" />\n\n'use strict';\n\nnamespace expenseApp.directives {\n\n    interface IWcUniqueAttributes extends ng.IAttributes  {\n        wcUniqueProperty: string;\n        wcUniqueKey: string;\n    }\n\n    class WcUniqueDirective implements ng.IDirective {\n\n        static $inject = ['$q', 'expenseApp.services.DataService'];\n        static instance($q: ng.IQService, dataService: expenseApp.services.DataService): ng.IDirective {\n            return new WcUniqueDirective($q, dataService);\n        }\n\n        restrict = 'A';\n        require = 'ngModel';\n        //Link function definition\n        link: (scope: ng.IScope, element: ng.IAugmentedJQuery, attrs: IWcUniqueAttributes, ngModel) => void;\n\n        constructor (private $q: ng.IQService, private dataService: expenseApp.services.DataService) {\n            this.link = this._link.bind(this);\n        }\n\n        _link(scope: ng.IScope, element: ng.IAugmentedJQuery, attrs: IWcUniqueAttributes, ngModel) {\n\n            var _this = this;\n\n            ngModel.$asyncValidators.unique = function (modelValue, viewValue) {\n                var deferred = _this.$q.defer(),\n                    currentValue = modelValue || viewValue,\n                    key = attrs.wcUniqueKey,\n                    property = attrs.wcUniqueProperty;\n\n                //First time the asyncValidators function is loaded the\n                //key won't be set  so ensure that we have\n                //key and propertyName before checking with the server\n                if (key && property) {\n                    this.dataService.checkUniqueValue(key, property, currentValue)\n                        .then(function (unique) {\n                            if (unique) {\n                                deferred.resolve(); //It's unique\n                            } else {\n                                deferred.reject(); //Add unique to $errors\n                            }\n                        });\n                    return deferred.promise;\n                } else {\n                    return _this.$q.when(true);\n                }\n            };\n        }\n    }\n\n    angular.module('expenseApp').directive('wcUnique', WcUniqueDirective.instance);\n}\n"],"sourceRoot":"/source/"}